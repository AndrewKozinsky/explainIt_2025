New Component: Video and Subtitles

Purpose

Компонент видеоплеера с субтитрами для русскоязычных пользователей, изучающих английский язык.

Компонент реализуется с нуля, как обособленная часть проекта, без изменения существующих страниц, компонентов и архитектуры.

Пользователь:
	•	загружает видео на английском языке (локально, без сервера)
	•	вводит субтитры в формате SRT
	•	воспроизводит видео, ориентируясь на субтитры

Использовать корневой компонент VideoRoot (face/_pages/video/VideoRoot). Он уже подключен и отображается на странице.

Компонент состоит из двух частей:
	1.	Верхняя часть — видео
	2.	Нижняя часть — субтитры и управление ими

⸻

Storage rules
	•	Использовать IndexedDB для хранения субтитров загруженных пользователем и данных о видео и текущем времени воспроизведения.
	•	Use a single IndexedDB helper file.
	•	No reusable database layers.

⸻

Video part

Loading and Display

При монтировании компонента:
	•	проверить наличие сохранённых данных о видео
	•	если данные есть — показать видео
	•	если данных нет — показать экран загрузки

Видео:
	•	хранится локально на компьютере пользователя
	•	не загружается на сервер

Desktop (mouse)
Экран загрузки:
	•	Заголовок: «Перетащите видео сюда»
	•	Подзаголовок: «Поддерживаются MP4, WebM, OGG, MKV»
	•	Кнопка: «Где взять и как перевести в нужный формат» (неактивная, без логики)

Пользователь загружает видео через drag-and-drop.

Touch devices
Так как drag-and-drop недоступен:
	•	Заголовок: «Выберите видео»
	•	Кнопка выбора файла (file input)
	•	Кнопка «Где взять и как перевести в нужный формат» (неактивная)

Errors
Если выбран файл неподдерживаемого формата:
	•	показать сообщение об ошибке «Неподходящий тип файла»
	•	сообщение располагается сразу после заголовка

После успешной загрузки видео:
	•	видео отображается в плеере

⸻

Playback Controls

Play / Pause
	•	клик / тап по любой области плеера
	•	клавиша Space

Перемотка
Жестом:
	•	горизонтальное перетаскивание мышью или пальцем
	•	слева направо — вперёд
	•	справа налево — назад
	•	скорость зависит от начальной вертикальной позиции:
	•	чем выше начальная точка — тем выше скорость (от 0.1x до 1x, линейная зависимость)

Клавиатура:
	•	← / → : шаг 2 секунды
	•	Shift + ← / → : шаг 10 секунд

Визуализация перемотки
	•	поверх видео накладывается полупрозрачный синий слой
	•	слой:
	•	начинается от левого края
	•	занимает всё пространство до текущей позиции
	•	по высоте занимает весь плеер

В центре экрана отображается:
	•	текущее время (70px)
	•	общее время (30px)
	•	формат: 09:18 / 1:48:32
	•	цвет текста: белый

Если перемотки нет в течение 1 секунды:
	•	слой и текст исчезают

⸻

Progress Bar
	•	контейнер снизу плеера
	•	высота контейнера: 10px
	•	видимая полоса: 5px, синего цвета

При наведении курсора:
	•	полоса занимает всю высоту контейнера
	•	клик перематывает видео к выбранной позиции

⸻

Volume Control

Жестом и мышью:
	•	вертикальное перетаскивание мышью

Клавиатура:
	•	↑ / ↓ : шаг 2%
	•	Shift + ↑ / ↓ : шаг 10%

Gesture conflict resolution:
	•	Horizontal movement has priority over vertical
	•	Vertical volume change applies only if vertical delta > horizontal delta

Визуализация громкости
	•	оранжевая горизонтальная полоса снизу плеера
	•	ширина: 100%
	•	высота пропорциональна громкости
	•	при 100% занимает всю высоту плеера

В центре экрана:
	•	текст с текущей громкостью в процентах
	•	цвет: белый
	•	высота текста: 70px

Если громкость не меняется 1 секунду:
	•	слой и текст исчезают

⸻

Delete Video Button
	•	кнопка появляется при наведении мышью на плеер
	•	For touch devices: show delete button via long press

При нажатии:
	•	видео удаляется
	•	данные очищаются
	•	возвращается экран загрузки

⸻

Subtitles on the Player
	•	если субтитры не заданы — ничего не отображать

Отображение
	•	субтитры располагаются внизу плеера поверх видео
	•	отображаются в виде одной длинной строки
	•	диалоги идут последовательно
	•	между диалогами могут быть паузы
	•	пауза видима, если конец предыдущего субтитра меньше начала следующего.
	•	продолжительность паузы нигде не показывается

Если есть пауза:
	•	отображается круг

Virtualization / Performance
	•	в DOM одновременно может быть не более 20 диалогов в DOM
	•	элементы, завершившиеся более 10 секунд назад, удаляются. Но мы должны сохранить буфер элементов до текущего времени для прокрутки назад
	•	новые элементы добавляются по мере воспроизведения

Interaction
	•	строку субтитров можно:
	•	перетаскивать мышью
	•	перетаскивать пальцем
	•	при воспроизведении строка автоматически прокручивается к текущему диалогу. Текущий диалог прокручивается в левую часть с короткой анимацией.
	•	клик по диалогу или паузе:
	•	перематывает видео к соответствующему моменту
	•	при ручной перемотке окно субтитров должно быть пересчитано немедленно

Styles
	•	текст субтитров:
	•	цвет: белый
	•	размер: 22px
	•	line-height: 26px
	•	круг паузы:
	•	цвет: белый
	•	opacity: 0.1
	•	радиус: 14px
	•	центрирован по горизонтали
	•	контейнер:
	•	padding-bottom: 10px
	•	padding-left/right: 20px
	•	фон отсутствует
	•	текущий диалог:
	•	акцентный фон
	•	padding-left/right: 4px
	•	border-radius: 3px

Pause Timer
	•	если текущая позиция — пауза:
	•	круг становится полностью непрозрачным
	•	круг — это circular countdown timer
	•	показывает оставшееся время до следующего диалога
	•	после окончания паузы:
	•	круг снова становится полупрозрачным
	•	реализация через requestAnimationFrame
	•	без внешних библиотек

⸻

Subtitles part

Subtitles Input

При монтировании:
	•	проверить наличие сохранённых субтитров
	•	если есть — показать
	•	если нет — показать поле ввода

Использовать компонент TextInput:
	•	количество строк: 5
	•	подпись: «Субтитры в формате SRT»

Подсказка формата
1
00:00:01,000 --> 00:00:04,000
Первая фраза субтитров

2
00:00:05,000 --> 00:00:08,000
Вторая фраза субтитров


Buttons
Под полем:
	•	слева: «Где взять субтитры» (без логики)
	•	справа: «Сохранить»

Кнопка «Сохранить»:
	•	неактивна, если:
	•	поле пустое
	•	формат некорректен
	•	сообщение об ошибке показывается у поля ввода

Cообщение об ошибке исчезает как только формат становится корректным.

После успешного сохранения:
	•	поле ввода скрывается
	•	появляется кнопка «Редактировать»

⸻

Subtitles List
	•	субтитры отображаются в виде списка абзацев
	•	каждый абзац:
	•	padding-left/right: 20px
	•	margin-bottom: 10px

Если между субтитрами есть пауза:
	•	между абзацами отображается горизонтальная линия:
	•	толщина: 2px
	•	цвет: акцентный
	•	слева круг:
	•	диаметр: 10px
	•	цвет: акцентный

Active state
	•	если текущее время совпадает с абзацем:
	•	текст абзаца — акцентный
	•	слева вертикальная линия:
	•	ширина: 3px
	•	цвет: акцентный
	•	если текущее время — пауза:
	•	горизонтальная линия становится акцентной

Interaction
	•	каждый абзац кликабелен
	•	при клике:
	•	воспроизведение перематывается
	•	hover:
	•	цвет текста становится синим
	•	cursor: pointer

Player subtitles and Subtitles List are two independent renderings based on the same parsed SRT data.

⸻

Clipboard rules

Если текущая точка воспроизведения попадает внутрь абзаца:
	•	в буфер обмена копируется полное предложение или предложения, к которым относится абзац

Правила
	1.	Определить текущий subtitle block по времени
	2.	Разбить текст на предложения

    3. If a sentence starts in a previous block, include previous blocks until the sentence start
    4. If a sentence ends in a next block, include next blocks until the sentence end
    5. Copy ONLY sentences that are fully completed
	6.	Если текущий subtitle block содержит несколько предложений, то копировать в буфер обмена эти предложения.

NLP
	•	Использовать compromise.js
	•	Язык: английский
	•	Без динамических импортов
	•	Без fallback-логики

⸻

SRT parsing rules
	•	Поддерживать multiline subtitles
	•	Формат времени: HH:MM:SS,mmm
	•	Записи разделяются пустой строкой
	•	При ошибке парсинга:
	•	показать сообщение под полем
	•	не сохранять данные

⸻

Development rules
	•	Не улучшать UX
	•	Не упрощать взаимодействия
	•	Следовать документу строго
	•	Если что-то неясно — сначала задать вопрос
	•	Сначала предложить план и структуру файлов, не писать код

⸻

Non-goals
	•	Серверная часть
	•	Оптимизация под мобильные браузеры
	•	Расширение форматов субтитров

⸻

Architecture clarification

- Business logic MAY be extracted:
  - fn/
- UI components must stay thin