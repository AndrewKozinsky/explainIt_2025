generator client {
    provider     = "prisma-client"
    output       = "../prisma/generated"
    moduleFormat = "cjs"
}

datasource db {
    provider = "postgresql"
}

model User {
    id                                      Int                  @id @default(autoincrement())
    email                                   String               @unique
    password                                String?
    email_confirmation_code                 String?
    email_confirmation_code_expiration_date String?
    is_email_confirmed                      Boolean              @default(false)
    is_user_confirmed                       Boolean              @default(false)
    balance                                 Int                  @default(0)
    created_at                              DateTime             @default(now())
    BalanceTransaction                      BalanceTransaction[]
    Payment                                 Payment[]
    BookPrivate                             BookPrivate[]
    VideoPrivate                            VideoPrivate[]
}

model BalanceTransaction {
    id         Int                    @id @default(autoincrement())
    user       User                   @relation(fields: [user_id], references: [id], onDelete: Cascade)
    user_id    Int
    type       BalanceTransactionType
    amount     Int
    payment    Payment?               @relation(fields: [payment_id], references: [id])
    payment_id Int?                   @unique
    created_at DateTime               @default(now())
}

model Payment {
    id                 Int                 @id @default(autoincrement())
    user               User                @relation(fields: [user_id], references: [id], onDelete: Cascade)
    user_id            Int
    amount             Int
    status             PaymentStatus       @default(PENDING)
    provider_name      PaymentProviderName @default(YOOKASSA)
    external_id        String              @unique
    BalanceTransaction BalanceTransaction?
    created_at         DateTime            @default(now())
    updated_at         DateTime            @default(now())
}

model BookPrivate {
    id          Int           @id @default(autoincrement())
    user        User          @relation(fields: [user_id], references: [id], onDelete: Cascade)
    user_id     Int
    author      String?
    name        String?
    note        String?
    created_at  DateTime      @default(now())
    BookChapter BookChapter[]
}

model BookPublic {
    id          Int           @id @default(autoincrement())
    cover       String
    author      String
    name        String
    note        String
    created_at  DateTime      @default(now())
    BookChapter BookChapter[]
}

model BookChapter {
    id                Int                 @id @default(autoincrement())
    book              BookPrivate?        @relation(fields: [book_id], references: [id], onDelete: Cascade)
    book_id           Int?
    book_public       BookPublic?         @relation(fields: [book_public_id], references: [id], onDelete: Cascade)
    book_public_id    Int?
    name              String?
    header            String?
    content           String?
    note              String?
    BookChapterPhrase BookChapterPhrase[]
    created_at        DateTime            @default(now())
}

model BookChapterPhrase {
    id                       Int                        @id @default(autoincrement())
    sentenceId               Int
    sentence                 String
    phraseWordsIdx           Int[]
    phrase                   String
    phraseTranslation        String
    phraseTranscription      String
    phraseAnalysis           String
    book_chapter             BookChapter                @relation(fields: [book_chapter_id], references: [id], onDelete: Cascade)
    book_chapter_id          Int
    BookChapterPhraseExample BookChapterPhraseExample[]
    created_at               DateTime                   @default(now())
}

model BookChapterPhraseExample {
    id                     Int               @id @default(autoincrement())
    book_chapter_phrase    BookChapterPhrase @relation(fields: [book_chapter_phrase_id], references: [id], onDelete: Cascade)
    book_chapter_phrase_id Int
    sentence               String
    translation            String
    created_at             DateTime          @default(now())
}

model VideoPrivate {
    id               Int      @id @default(autoincrement())
    user             User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
    user_id          Int
    file_name        String?
    file_s3_key      String?
    file_url         String?
    is_file_uploaded Boolean  @default(false)
    name             String?
    text             String?
    text_resolved    String?
    created_at       DateTime @default(now())
    updated_at       DateTime @default(now())
}

model EnglishRussianDictionary {
    id            Int      @id @default(autoincrement())
    eng           String
    rus           String
    transcription String?
    created_at    DateTime @default(now())
    updated_at    DateTime @default(now())
}

enum BalanceTransactionType {
    TOP_UP
    CHARGE
    ACCOUNT_CONFIRMATION_WELCOME_BONUS
}

enum PaymentStatus {
    PENDING
    SUCCESS
    FAILED
    CANCELED
}

enum PaymentProviderName {
    YOOKASSA
}
