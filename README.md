## Запуск в режиме разработки
В корне проекта запустите:
```docker compose -f docker-compose.dev.yml up --build```

## Разворачивание на сервере
Перед запуском на сервере можно сделать проверку на то, соберётся ли там проект:
```docker compose -f docker-compose.server-check.yml up --build -d```

На сервере в корне проекта запустите:
```docker compose -f docker-compose.server.yml up --build -d```

## Генерирование файлов Докера
Сайт запускается в контейнере Докера. Есть 5 файлов для запуска docker compose: для тестирования (на своём компьютере), разработки (на своём компьютере), для проверки что он запустится на сервере (на своём компьютере), для разворачивания ветки develop и ветки master на сервере (опубликованная версия). Так как эти файлы во многом похожи, то они генерируются из файла конфигурации. Для этого нужно зайти в infrastructure/docker-files-generator и запустить
```npm run generate-docker-files```.

Проект, запущенный для тестирования, имеет моковые данные на сервере и другой набор статей на клиенте. Проект для разработки работает так же как опубликованные. А проекты для сервера имеет команды для предварительной сборки.

## Клиент

### Генерирование блоков с транскрипциями и озвучкой
Перейдите в папку клиента
```cd face```

В файле face/articles/transcriptions/transcriptions.ts находится объект transcriptions откуда берутся транскрипции и озвученные предложения. Ключ — предложение на английском с убранными недопустимыми символами. В значении пишется оригинальное предложение на английском, транскрипция и булево значение есть ли звукозапись.

Чтобы пройти по всем главам курса и сгенерировать блоки транскрипций используйте команду
```npm run generate-transcription-items```
Но сама транскрипция и звукозапись в блоке будут пустыми.

Чтобы в пустые транскрипции записать значение запустите
```generate-transcription-texts```
Это команда обращается к серверу для получения транскрипции в ГигаЧате. Поэтому запуск Докера не должен быть в режиме тестирования.

Как сгенерировать аудио в автоматическом режиме пока не придумал.

### Сквозное тестирование
Перейдите в папку клиента
```cd face```

Запустите Playwright
```npm run test:e2e```

### Запуск в режиме разработки
Перейдите в папку клиента
```cd face```

### Генерирование файлов GraphQL
Перейдите в папку клиента
```cd face```

Создайте в папке graphql недостающие файлы .graphql. Там должны быть описаны названия запросов и мутаций, а также типы данных, которые они возвращают. Под каждую группу запросов есть свою папка. Шаблоны можно получить из http://localhost:3001/graphql.

Запустите генерацию
```npm run codegen```

В graphql/index.ts появится типы данных и хуки для манипулирования данными.

Запросы выполняются сразу при отрисовке компонента. Чтобы выполнять запрос по требованию, нужно написать код по аналогии с face/graphql/ai/graphqlAIQueries.ts. 

## Сервер

### Сквозное тестирование
Перейдите в папку сервера
```cd server```

Запуск тестов
```npm run test:e2e```

### Модульное тестирование
Перейдите в папку сервера
```cd server```

Запустите Jest
```npm run test```
или
```npm run test:watch```

### Генерирование файла Призмы и применение миграции
Если в файле с конфигурацией базы данных (server/src/db/dbConfig/dbConfig.ts) появились изменения, то нужно по ней сгенерировать файл Призмы.

Перейдите в папку сервера
```cd server```

Запустите команду
```npm run generatePrismaFile```

Затем выполните команду для создания файла миграции и применения миграции:
```npm run migrate:dev```

Если нужно стереть все данные:
```npx prisma migrate reset```

И сгенерируйте типы данных для клиента:
```npm run migrate:generate-types```

### Прочее
Деньги считаются и хранятся в БД в копейках.